FROM python:3.11-bullseye

ARG DB_HOSTNAME
ENV DB_HOSTNAME $DB_HOSTNAME

ARG DB_PASSWORD
ENV DB_PASSWORD $DB_PASSWORD

ARG DB_USER
ENV DB_USER $DB_USER

ARG DB_PORT
ENV DB_PORT 5432

ARG DB_NAME
ENV DB_NAME $DB_NAME

ARG VERSION
ENV VERSION $VERSION

ARG PROJECT_ID
ENV PROJECT_ID $PROJECT_ID

ARG USER_EVENT_SUBSCRIPTION_ID
ENV USER_EVENT_SUBSCRIPTION_ID $USER_EVENT_SUBSCRIPTION_ID

ARG EVENTS_EVENT_SUBSCRIPTION_ID
ENV EVENTS_EVENT_SUBSCRIPTION_ID $EVENTS_EVENT_SUBSCRIPTION_ID

ARG ORGANIZATIONS_EVENT_SUBSCRIPTION_ID
ENV ORGANIZATIONS_EVENT_SUBSCRIPTION_ID $ORGANIZATIONS_EVENT_SUBSCRIPTION_ID

ARG USER_EVENT_TOPIC_ID
ENV USER_EVENT_TOPIC_ID $USER_EVENT_TOPIC_ID

ARG EVENTS_EVENT_TOPIC_ID
ENV EVENTS_EVENT_TOPIC_ID $EVENTS_EVENT_TOPIC_ID

ARG ORGANIZATIONS_EVENT_TOPIC_ID
ENV ORGANIZATIONS_EVENT_TOPIC_ID $ORGANIZATIONS_EVENT_TOPIC_ID

ARG SERVICE_ACCOUNT
ENV SERVICE_ACCOUNT $SERVICE_ACCOUNT

RUN pip install --upgrade pip

COPY . /opt/organizations-service
WORKDIR /opt/organizations-service
RUN pip install -r requirements.txt

WORKDIR /opt/organizations-service
CMD ["gunicorn", "-b", "0.0.0.0:8002", "--preload", "-w", "4", "wsgi:app"]

EXPOSE 8002
